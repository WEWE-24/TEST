local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local menuOpen = false
local TweenService = game:GetService("TweenService")

local scriptsList = {
    {
        Name = "ESP Universel",
        Url = "https://raw.githubusercontent.com/tonnomgithub/tonrepo/main/esp.lua"
    },
    {
        Name = "Autre Script",
        Url = "https://raw.githubusercontent.com/tonnomgithub/tonrepo/main/autrescript.lua"
    },
    {
        Name = "Fly Script",
        Url = "https://raw.githubusercontent.com/tonnomgithub/tonrepo/main/fly.lua"
    },
    {
        Name = "Speed Hack",
        Url = "https://raw.githubusercontent.com/tonnomgithub/tonrepo/main/speed.lua"
    }
}

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ScriptLoaderGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 350, 0, 360)
Frame.Position = UDim2.new(0.5, -175, 0.5, -180)
Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
Frame.BorderSizePixel = 0
Frame.Parent = ScreenGui
Frame.ClipsDescendants = true
Frame.AnchorPoint = Vector2.new(0.5, 0.5)
Frame.Active = true
Frame.Draggable = true

-- Barre de titre
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = Frame

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(1, -40, 1, 0)
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "Script Loader"
TitleLabel.TextColor3 = Color3.new(1, 1, 1)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextSize = 20
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleBar

local UnloadButton = Instance.new("TextButton")
UnloadButton.Size = UDim2.new(0, 70, 0, 30)
UnloadButton.Position = UDim2.new(1, -80, 0, 5)
UnloadButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
UnloadButton.TextColor3 = Color3.new(1, 1, 1)
UnloadButton.Text = "Unload"
UnloadButton.Font = Enum.Font.GothamBold
UnloadButton.TextSize = 16
UnloadButton.AutoButtonColor = false
UnloadButton.Parent = TitleBar
UnloadButton.ClipsDescendants = true

UnloadButton.MouseEnter:Connect(function()
    UnloadButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
end)
UnloadButton.MouseLeave:Connect(function()
    UnloadButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
end)
UnloadButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)


-- Zone de recherche
local SearchBox = Instance.new("TextBox")
SearchBox.Size = UDim2.new(1, -20, 0, 30)
SearchBox.Position = UDim2.new(0, 10, 0, 45)
SearchBox.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
SearchBox.TextColor3 = Color3.new(1, 1, 1)
SearchBox.Font = Enum.Font.Gotham
SearchBox.PlaceholderText = "Rechercher un script..."
SearchBox.TextSize = 16
SearchBox.ClearTextOnFocus = false
SearchBox.Parent = Frame

-- Container pour les boutons de scripts
local ButtonContainer = Instance.new("ScrollingFrame")
ButtonContainer.Size = UDim2.new(1, -20, 1, -110)
ButtonContainer.Position = UDim2.new(0, 10, 0, 80)
ButtonContainer.BackgroundTransparency = 1
ButtonContainer.BorderSizePixel = 0
ButtonContainer.ScrollBarThickness = 6
ButtonContainer.Parent = Frame
ButtonContainer.CanvasSize = UDim2.new(0, 0, 0, 0)

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 8)
UIListLayout.Parent = ButtonContainer

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, -20, 0, 30)
StatusLabel.Position = UDim2.new(0, 10, 1, -35)
StatusLabel.BackgroundTransparency = 1
StatusLabel.TextColor3 = Color3.fromRGB(170, 170, 170)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 14
StatusLabel.Text = "Prêt."
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.Parent = Frame

-- Fonction pour charger et exécuter le script depuis une URL
local function executeScriptFromUrl(url)
    StatusLabel.Text = "Téléchargement en cours..."
    local success, result = pcall(function()
        return game:HttpGet(url)
    end)

    if success then
        StatusLabel.Text = "Exécution du script..."
        local func, err = loadstring(result)
        if func then
            local ok, err2 = pcall(func)
            if ok then
                StatusLabel.Text = "Script exécuté avec succès."
            else
                StatusLabel.Text = "Erreur lors de l'exécution: "..tostring(err2)
            end
        else
            StatusLabel.Text = "Erreur de compilation: "..tostring(err)
        end
    else
        StatusLabel.Text = "Erreur de téléchargement: "..tostring(result)
    end
end

local buttons = {}

local function createButton(scriptInfo)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 0, 40)
    button.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    button.TextColor3 = Color3.new(1, 1, 1)
    button.Font = Enum.Font.Gotham
    button.TextSize = 18
    button.Text = scriptInfo.Name
    button.AutoButtonColor = false
    button.Parent = ButtonContainer

    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(90, 90, 110)
    end)
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    end)

    button.MouseButton1Click:Connect(function()
        executeScriptFromUrl(scriptInfo.Url)
    end)

    return button
end

local function refreshButtons(filterText)
    filterText = filterText:lower()
    for i, btnData in ipairs(buttons) do
        local visible = btnData.ScriptInfo.Name:lower():find(filterText) ~= nil
        btnData.Button.Visible = visible
    end
    -- Ajuster la taille du Canvas de défilement selon les boutons visibles
    task.wait(0.05) -- léger délai pour que Visible soit pris en compte
    local contentSize = 0
    for _, btnData in ipairs(buttons) do
        if btnData.Button.Visible then
            contentSize = contentSize + btnData.Button.AbsoluteSize.Y + UIListLayout.Padding.Offset
        end
    end
    ButtonContainer.CanvasSize = UDim2.new(0, 0, 0, contentSize)
end

-- Créer tous les boutons au début
for _, scriptInfo in ipairs(scriptsList) do
    local btn = createButton(scriptInfo)
    table.insert(buttons, {Button = btn, ScriptInfo = scriptInfo})
end

-- Mise à jour de la liste à chaque changement dans la barre de recherche
SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
    refreshButtons(SearchBox.Text)
end)

local function openMenu()
    Frame.Visible = true
    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tweenSize = TweenService:Create(Frame, tweenInfo, {Size = UDim2.new(0, 350, 0, 360)})
    local tweenBg = TweenService:Create(Frame, tweenInfo, {BackgroundTransparency = 0})

    tweenSize:Play()
    tweenBg:Play()
end

local function closeMenu()
    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
    local tweenSize = TweenService:Create(Frame, tweenInfo, {Size = UDim2.new(0, 350, 0, 0)})
    local tweenBg = TweenService:Create(Frame, tweenInfo, {BackgroundTransparency = 1})

    tweenSize:Play()
    tweenBg:Play()

    tweenSize.Completed:Connect(function()
        Frame.Visible = false
    end)
end


UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.RightShift then
        if menuOpen then
            closeMenu()
            menuOpen = false
        else
            openMenu()
            menuOpen = true
        end
    end
end)
-- Initialiser l'affichage
refreshButtons("")
